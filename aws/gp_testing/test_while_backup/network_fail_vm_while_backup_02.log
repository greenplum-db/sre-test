nohup: ignoring input
====================Start of test==================
====================Start backup after the  network issue is resumed and segments are recovered and rebalaned======================
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-Starting gprecoverseg with args: -a
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-local Greenplum Version: 'postgres (Greenplum Database) 6.13.0 build commit:4f1adf8e247a9685c19ea02bcaddfdc200937ecd'
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-master Greenplum Version: 'PostgreSQL 9.4.24 (Greenplum Database 6.13.0 build commit:4f1adf8e247a9685c19ea02bcaddfdc200937ecd) on x86_64-unknown-linux-gnu, compiled by gcc (GCC) 6.4.0, 64-bit compiled on Dec 16 2020 19:38:24'
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-Obtaining Segment details from master...
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-Heap checksum setting is consistent between master and the segments that are candidates for recoverseg
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-Greenplum instance recovery parameters
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:----------------------------------------------------------
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-Recovery type              = Standard
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:----------------------------------------------------------
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-Recovery 1 of 3
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:----------------------------------------------------------
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Synchronization mode                 = Incremental
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Failed instance host                 = sdw1_ipv4
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Failed instance address              = sdw1_ipv4
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Failed instance directory            = /data1/gpdb/primary/gpseg0
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Failed instance port                 = 4000
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Recovery Source instance host        = sdw2_ipv4
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Recovery Source instance address     = sdw2_ipv4
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Recovery Source instance directory   = /data1/gpdb/mirror/gpseg0
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Recovery Source instance port        = 5000
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Recovery Target                      = in-place
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:----------------------------------------------------------
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-Recovery 2 of 3
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:----------------------------------------------------------
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Synchronization mode                 = Incremental
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Failed instance host                 = sdw1_ipv4
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Failed instance address              = sdw1_ipv4
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Failed instance directory            = /data2/gpdb/primary/gpseg1
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Failed instance port                 = 4001
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Recovery Source instance host        = sdw2_ipv4
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Recovery Source instance address     = sdw2_ipv4
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Recovery Source instance directory   = /data2/gpdb/mirror/gpseg1
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Recovery Source instance port        = 5001
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Recovery Target                      = in-place
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:----------------------------------------------------------
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-Recovery 3 of 3
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:----------------------------------------------------------
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Synchronization mode                 = Incremental
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Failed instance host                 = sdw1_ipv4
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Failed instance address              = sdw1_ipv4
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Failed instance directory            = /data3/gpdb/primary/gpseg2
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Failed instance port                 = 4002
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Recovery Source instance host        = sdw2_ipv4
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Recovery Source instance address     = sdw2_ipv4
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Recovery Source instance directory   = /data3/gpdb/mirror/gpseg2
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Recovery Source instance port        = 5002
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-   Recovery Target                      = in-place
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:----------------------------------------------------------
20210225:15:21:02:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-Starting to modify pg_hba.conf on primary segments to allow replication connections
20210225:15:21:08:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-Successfully modified pg_hba.conf on primary segments to allow replication connections
20210225:15:21:08:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-3 segment(s) to recover
20210225:15:21:08:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-Ensuring 3 failed segment(s) are stopped
20210225:15:21:09:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-21655: /data1/gpdb/primary/gpseg0
20210225:15:21:10:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-880: /data2/gpdb/primary/gpseg1
20210225:15:21:11:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-881: /data3/gpdb/primary/gpseg2
20210225:15:21:12:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-Ensuring that shared memory is cleaned up for stopped segments
20210225:15:21:12:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-Updating configuration with new mirrors
20210225:15:21:12:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-Updating mirrors
20210225:15:21:12:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-Running pg_rewind on required mirrors
......................................................................
20210225:15:22:25:024388 gprecoverseg:mdw_ipv4:gpadmin-[WARNING]:-servers diverged at WAL position F/AA976640 on timeline 13
rewinding from last common checkpoint at F/AA9765C0 on timeline 13

could not seek in target file "/data2/gpdb/primary/gpseg1/pg_xlog/0000000E0000000F0000003A": Input/output error
Failure, exiting
20210225:15:22:25:024388 gprecoverseg:mdw_ipv4:gpadmin-[WARNING]:-Incremental recovery failed for dbid 3. You must use gprecoverseg -F to recover the segment.
20210225:15:22:25:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-Starting mirrors
20210225:15:22:25:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-era is None
20210225:15:22:25:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-Commencing parallel segment instance startup, please wait...
.
20210225:15:22:26:024388 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-Process results...
================================Check if all segments are up and go ahead to rebalance===========================
 dbid | content | role | preferred_role | mode | status | port | hostname  |  address  |          datadir           
------+---------+------+----------------+------+--------+------+-----------+-----------+----------------------------
    3 |       1 | m    | p              | n    | d      | 4001 | sdw1_ipv4 | sdw1_ipv4 | /data2/gpdb/primary/gpseg1
   15 |       1 | p    | m              | n    | u      | 5001 | sdw2_ipv4 | sdw2_ipv4 | /data2/gpdb/mirror/gpseg1
   24 |      10 | m    | m              | n    | d      | 5001 | sdw1_ipv4 | sdw1_ipv4 | /data2/gpdb/mirror/gpseg10
   14 |       0 | p    | m              | s    | u      | 5000 | sdw2_ipv4 | sdw2_ipv4 | /data1/gpdb/mirror/gpseg0
    2 |       0 | m    | p              | s    | u      | 4000 | sdw1_ipv4 | sdw1_ipv4 | /data1/gpdb/primary/gpseg0
   16 |       2 | p    | m              | s    | u      | 5002 | sdw2_ipv4 | sdw2_ipv4 | /data3/gpdb/mirror/gpseg2
    4 |       2 | m    | p              | s    | u      | 4002 | sdw1_ipv4 | sdw1_ipv4 | /data3/gpdb/primary/gpseg2
(7 rows)

20210225:15:24:07:025038 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-Starting gprecoverseg with args: -ar
20210225:15:24:07:025038 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-local Greenplum Version: 'postgres (Greenplum Database) 6.13.0 build commit:4f1adf8e247a9685c19ea02bcaddfdc200937ecd'
20210225:15:24:07:025038 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-master Greenplum Version: 'PostgreSQL 9.4.24 (Greenplum Database 6.13.0 build commit:4f1adf8e247a9685c19ea02bcaddfdc200937ecd) on x86_64-unknown-linux-gnu, compiled by gcc (GCC) 6.4.0, 64-bit compiled on Dec 16 2020 19:38:24'
20210225:15:24:07:025038 gprecoverseg:mdw_ipv4:gpadmin-[INFO]:-Obtaining Segment details from master...
20210225:15:24:07:025038 gprecoverseg:mdw_ipv4:gpadmin-[CRITICAL]:-gprecoverseg failed. (Reason='Down segments still exist.  All segments must be up to rebalance.') exiting...
20210225:15:25:07:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-Starting gpstate with args: 
20210225:15:25:07:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-local Greenplum Version: 'postgres (Greenplum Database) 6.13.0 build commit:4f1adf8e247a9685c19ea02bcaddfdc200937ecd'
20210225:15:25:07:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-master Greenplum Version: 'PostgreSQL 9.4.24 (Greenplum Database 6.13.0 build commit:4f1adf8e247a9685c19ea02bcaddfdc200937ecd) on x86_64-unknown-linux-gnu, compiled by gcc (GCC) 6.4.0, 64-bit compiled on Dec 16 2020 19:38:24'
20210225:15:25:07:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-Obtaining Segment details from master...
20210225:15:25:07:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-Gathering data from segments...
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-Greenplum instance status summary
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-----------------------------------------------------
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-   Master instance                                           = Active
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-   Master standby                                            = smdw_ipv4
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-   Standby master state                                      = Standby host passive
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-   Total segment instance count from metadata                = 24
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-----------------------------------------------------
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-   Primary Segment Status
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-----------------------------------------------------
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-   Total primary segments                                    = 12
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-   Total primary segment valid (at master)                   = 11
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[WARNING]:-Total primary segment failures (at master)                = 1                      <<<<<<<<
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[WARNING]:-Total number of postmaster.pid files missing              = 1                      <<<<<<<<
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-   Total number of postmaster.pid files found                = 11
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[WARNING]:-Total number of postmaster.pid PIDs missing               = 1                      <<<<<<<<
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-   Total number of postmaster.pid PIDs found                 = 11
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[WARNING]:-Total number of /tmp lock files missing                   = 1                      <<<<<<<<
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-   Total number of /tmp lock files found                     = 11
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[WARNING]:-Total number postmaster processes missing                 = 1                      <<<<<<<<
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-   Total number postmaster processes found                   = 11
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-----------------------------------------------------
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-   Mirror Segment Status
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-----------------------------------------------------
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-   Total mirror segments                                     = 12
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-   Total mirror segment valid (at master)                    = 11
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[WARNING]:-Total mirror segment failures (at master)                 = 1                      <<<<<<<<
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[WARNING]:-Total number of postmaster.pid files missing              = 1                      <<<<<<<<
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-   Total number of postmaster.pid files found                = 11
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[WARNING]:-Total number of postmaster.pid PIDs missing               = 1                      <<<<<<<<
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-   Total number of postmaster.pid PIDs found                 = 11
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[WARNING]:-Total number of /tmp lock files missing                   = 1                      <<<<<<<<
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-   Total number of /tmp lock files found                     = 11
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[WARNING]:-Total number postmaster processes missing                 = 1                      <<<<<<<<
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-   Total number postmaster processes found                   = 11
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[WARNING]:-Total number mirror segments acting as primary segments   = 3                      <<<<<<<<
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-   Total number mirror segments acting as mirror segments    = 9
20210225:15:25:08:025110 gpstate:mdw_ipv4:gpadmin-[INFO]:-----------------------------------------------------
 dbid | content | role | preferred_role | mode | status | port | hostname  |  address  |          datadir           
------+---------+------+----------------+------+--------+------+-----------+-----------+----------------------------
    3 |       1 | m    | p              | n    | d      | 4001 | sdw1_ipv4 | sdw1_ipv4 | /data2/gpdb/primary/gpseg1
   15 |       1 | p    | m              | n    | u      | 5001 | sdw2_ipv4 | sdw2_ipv4 | /data2/gpdb/mirror/gpseg1
   24 |      10 | m    | m              | n    | d      | 5001 | sdw1_ipv4 | sdw1_ipv4 | /data2/gpdb/mirror/gpseg10
   14 |       0 | p    | m              | s    | u      | 5000 | sdw2_ipv4 | sdw2_ipv4 | /data1/gpdb/mirror/gpseg0
    2 |       0 | m    | p              | s    | u      | 4000 | sdw1_ipv4 | sdw1_ipv4 | /data1/gpdb/primary/gpseg0
   16 |       2 | p    | m              | s    | u      | 5002 | sdw2_ipv4 | sdw2_ipv4 | /data3/gpdb/mirror/gpseg2
    4 |       2 | m    | p              | s    | u      | 4002 | sdw1_ipv4 | sdw1_ipv4 | /data3/gpdb/primary/gpseg2
(7 rows)

====================End of test==================
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause. Creating a NULL policy entry.
SELECT 1000000
 count | gp_segment_id 
-------+---------------
 83760 |             6
 83108 |             1
 83206 |             3
 83237 |             9
 83047 |             2
 83496 |             8
 83245 |             7
 83053 |            11
 83659 |             4
 83780 |             0
 83030 |             5
 83379 |            10
(12 rows)

DROP TABLE
